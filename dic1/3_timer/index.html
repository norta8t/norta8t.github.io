<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>3. Timer - HEL - DIC1</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "3. Timer";
        var mkdocs_page_input_path = "3_timer.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> HEL - DIC1
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">0. Herzlich Willkommen zu DIC1</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../1_digital/">1. Digitale Elektronik</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../2_c/">2. C-Programmierung</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="#">3. Timer</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#31-allgemeines">3.1 Allgemeines</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#32-timer0">3.2 Timer0</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#321-ctc-mode-clear-timer-on-compare">3.2.1 CTC Mode (Clear Timer on Compare)</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#33-timer1">3.3 Timer1</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#331-unterschiede-zu-timer0">3.3.1 Unterschiede zu Timer0</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#332-icp-mode">3.3.2 ICP Mode</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#3331-beispiel">3.3.3.1 Beispiel</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#333-allgemeines-zur-zeitmessung">3.3.3 Allgemeines zur Zeitmessung</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#34-timer-2">3.4 Timer 2</a>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../4_switches/">4. Schalter / Pegelwandlung</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../5_adc/">5. ADC - Analog Digital Converter</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../6_dac/">6. DAC - Digital Analog Converter</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../7_uart/">7. Schnittstellen</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../A_ressources/">A. Ressourcen</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">HEL - DIC1</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">3. Timer</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="3-timer">3. Timer</h1>
<p>In diesem Abschnitt werden die Grundlagen zu Timer0, Timer1 und Timer2 behandelt. Eine tiefergehende Einführung findet dabei im Wahlfach statt.</p>
<h2 id="31-allgemeines">3.1 Allgemeines</h2>
<h2 id="32-timer0">3.2 Timer0</h2>
<h3 id="321-ctc-mode-clear-timer-on-compare">3.2.1 CTC Mode (Clear Timer on Compare)</h3>
<p>Der CTC Mode kann verwendet werden um ein Rechtecksignal zu erzeugen. Dies wird erreicht, indem ein Ausgang beim Erreichen des OCR-Wertes getoggelt wird (entweder manuell oder über den Compare Output toggle mode).</p>
<p>Dabei berechnet sich die Frequenz mit der folgenden Formel:</p>
<p>N ... Prescaler Wert</p>
<p><img alt="fOCN" src="../ressources/3/CTC_waveform_frequency.png" /></p>
<h2 id="33-timer1">3.3 Timer1</h2>
<h3 id="331-unterschiede-zu-timer0">3.3.1 Unterschiede zu Timer0</h3>
<h3 id="332-icp-mode">3.3.2 ICP Mode</h3>
<p>Port D, Bit 6 hat als alternative Funktion <strong>ICP1</strong> (Input Capture Pin für Timer 1). Das <strong>Input Capture Register (ICR1)</strong> kann den Timer/Counter Wert zu einem externen (flankengetriggerten) Ereignis speichern.</p>
<h4 id="3331-beispiel">3.3.3.1 Beispiel</h4>
<p>Im folgenden Beispiel wird mit Timer 0 ein Signal erzeugt, welches am Ausgang PB0 ausgegeben wird.</p>
<p>Dieses Signal wird mit PD6 verbunden, wo mit Timer 1 die Periodendauer/Frequenz des Signals bestimmt wird und auf dem Display ausgegeben wird.</p>
<p><a href="../ressources/3/2321-2024-03-12-main.c">Code Stand: 13.03.2024</a></p>
<p>Die Periodendauer/Frequenz wird dabei mit folgenden Formeln bestimmt:</p>
<p><img alt="ICR1 Periode/Frequenz" src="../ressources/3/ICR1_period_frequency.png" /></p>
<h3 id="333-allgemeines-zur-zeitmessung">3.3.3 Allgemeines zur Zeitmessung</h3>
<p>Im bisherigen Beispiel haben wir nur betrachtet, wie die Zeit zwischen zwei (steigenden) Flanken berechnet werden kann. Dabei war zu beachten, dass der Zähler nicht überläuft, sprich die Periodendauer nicht länger ist als 2^16 Taktzyklen (Timer1). Für z.B. die Implementierung einer Stopuhr ist dies nicht ausreichend. Im folgenden werden allgemeine Hinweise gegeben, was bei einer Zeitmessung/Stoppuhr beachtet werden muss.</p>
<p><em>Problem 1: Überlauf des Zählers</em></p>
<p>Der maximale Zählerwert ist begrenzt durch die Bitbreite des verwendeten Timers (8 bzw. 16 bit).</p>
<p><img alt="ICR1 Zeitmessung Überlauf" src="../ressources/3/time_measurement_overflow.png" /></p>
<p>Als allgemeine Formel zum berechnen der Anzahl der ticks zwischen START und STOP kann verwendet werden:</p>
<p><img alt="Berechnung ticks" src="../ressources/3/formula_time_measurement.png" /></p>
<p><em>Problem 2: Zwischenzeit</em></p>
<p>Der Timer kann für die Messung der Zwischenzeit nicht angehalten werden da dies eine Fehlzeit ergeben würde.</p>
<p>Als Lösung können Schattenregister verwendet werden (Double Buffered Register).</p>
<p>Weitergehende Informationen finden sich z.B. <a href="https://developerhelp.microchip.com/xwiki/bin/view/products/mcu-mpu/8-bit-avr/structure/double-buffer/">hier</a></p>
<p><em>Problem 3: Datentypen</em></p>
<p>Für die Speicherung von langen Zeitmessugen müssen Datentypen mit großen Wertebereichen gewählt werden, z.B. uint32_t oder uint64_t. Siehe auch Kapittel <em>Datentypen</em> im Modul C-Programmierung.</p>
<h2 id="34-timer-2">3.4 Timer 2</h2>
<p>Timer2 hat im Wesentlichen die gleichen Modi wie Timer0 und ist ebenfalls ein 8-bit Timer/Counter und leichte Abweichungen (z.B. andere Prescaler)
Wie bei Timer1 (ICP Mode, insbesondere für Zeitmessung) wird im folgenden für Timer2 nur auf eine Besonderheit eingegangen: die Möglichkeit einen <strong>Real Time Counter/Clock (RTC)</strong> zu implementieren.</p>
<p>Bei setzen des Bits AS2 im ASSR Register, wird Timer2/Counter2 <em>asynchron</em> vom Eingang TOSC1 getaktet. Dabei wird ein Quarz twischen den Pins TOSC1 und TOSC2 angeschlossen. Der interne Oszillator ist dabei optimiert für die Verwendung eines 32.768 kHz Quarzes. Diese Quarze sind typisch für Uhrenanwendungen da:</p>
<ol>
<li>Günstig herzustellen</li>
<li>Niedrigerer Stromverbrauch (wg. niedriger Frequenz)</li>
<li>Teilbar um z.B. 1Hz Signal zu erzeugen</li>
</ol>
<p>So ergibt z.B. ein Prescaler von 128 bei einem 8-bit Zähler einen Zählerüberlauf jede Sekunde.</p>
<p>Details finden sich im Datenblatt im Abschnitt <em>Asyncrhonous Operation of the Timer/Counter2.</em></p>
<p><img alt="Timer2 RTC" src="../ressources/3/timer2.png" /></p>
<p>Die folgende Application Note <a href="../ressources/3/AVR134.pdf">AVR Application Note 134</a> beschreibt, wie man eine RTC für einen AVR implementieren kann.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../2_c/" class="btn btn-neutral float-left" title="2. C-Programmierung"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../4_switches/" class="btn btn-neutral float-right" title="4. Schalter / Pegelwandlung">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../2_c/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../4_switches/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
